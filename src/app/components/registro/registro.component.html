



<div class="registro-wrapper" style="display: flex; flex-direction: column; align-items: center; width: 100%; min-height: 100vh;">
    
    <app-mensaje *ngIf="mensajeVisible" [mensaje]="mensajeTexto" [tipo]="mensajeTipo" [autoCerrar]="true"></app-mensaje>
       
    
    <div class="w-100 d-flex justify-content-end align-items-center lang-bar mb-4" style="margin-top: 2rem;">
      <span class="lang-label me-2">{{ 'HOME.SELECT_LANGUAGE' | translate }}</span>
      <select [(ngModel)]="idioma" (change)="cambiarIdioma(idioma)" class="form-select w-auto me-2">
        <option *ngFor="let lang of idiomasDisponibles" [value]="lang.code">{{ lang.label }}</option>
      </select>
    </div>
    <div class="registro-card">
        <!-- <h2 class="text-center mb-4">Registro</h2> -->

 <!--     <button class="btn-cerrar-sesion" (click)="volverHome()">Volver</button> -->
      <div class="volver-container">
        <button class="btn-cerrar-sesion" (click)="volverHome()">← {{ 'REGISTRO.VOLVER' | translate }}</button>
      </div>

      <h2 class="titulo-centro">{{ 'REGISTRO.TITULO' | translate }}</h2>
     

        <div *ngIf="!perfilSeleccionado" class="zona-botones">
      <div class="boton-card" (click)="seleccionarPerfil('paciente')">
        <img src="assets/img/botonPaciente.png" alt="{{ 'REGISTRO.PACIENTE' | translate }}" />
        <p>{{ 'REGISTRO.PACIENTE' | translate }}</p>
      </div>
      <div class="boton-card" (click)="seleccionarPerfil('especialista')">
        <img src="assets/img/botonEspecialista.png" alt="{{ 'REGISTRO.ESPECIALISTA' | translate }}" />
        <p>{{ 'REGISTRO.ESPECIALISTA' | translate }}</p>
      </div>
        </div>

  <!--       <div style="background-color: yellow; padding: 1rem; font-size: 1.2rem;">
  DEBUG CAPTCHA: {{ captchaPregunta }}
</div> -->

        <form *ngIf="perfilSeleccionado" [formGroup]="registroForm" (ngSubmit)="registrar()" class="formulario">

          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label w-100">{{ 'REGISTRO.NOMBRE' | translate }}
                <input formControlName="nombre" class="form-control mt-1" placeholder="{{ 'REGISTRO.NOMBRE' | translate }}" (keydown)="soloLetras($event)" />
                <div *ngIf="registroForm.get('nombre')?.touched && registroForm.get('nombre')?.errors?.['required']" style="font-size: 0.9em;">
                  <span style="color: red;">El nombre es obligatorio.</span>
                </div>
              </label>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label w-100">{{ 'REGISTRO.APELLIDO' | translate }}
                <input formControlName="apellido" class="form-control mt-1" placeholder="{{ 'REGISTRO.APELLIDO' | translate }}" (keydown)="soloLetras($event)" />
                <div *ngIf="registroForm.get('apellido')?.touched && registroForm.get('apellido')?.errors?.['required']" style="font-size: 0.9em;">
                  <span style="color: red;">El apellido es obligatorio.</span>
                </div>
              </label>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label w-100">{{ 'REGISTRO.EDAD' | translate }}
                <input formControlName="edad" class="form-control mt-1" placeholder="{{ 'REGISTRO.EDAD' | translate }}" (keydown)="soloNumeros($event)" />
                <div *ngIf="registroForm.get('edad')?.touched && registroForm.get('edad')?.errors?.['min']" style="font-size: 0.9em;">
                  <span style="color: red;">Debe ser mayor de 18 años.</span>
                </div>
              </label>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label w-100">{{ 'REGISTRO.DNI' | translate }}
                <input formControlName="dni" class="form-control mt-1" placeholder="{{ 'REGISTRO.DNI' | translate }}" (keydown)="soloNumeros($event)" maxlength="8" />
              </label>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label w-100">{{ 'REGISTRO.EMAIL' | translate }}
                <input formControlName="email" class="form-control mt-1" placeholder="{{ 'REGISTRO.EMAIL' | translate }}" />
                <div *ngIf="registroForm.get('email')?.touched && registroForm.get('email')?.errors?.['required']" style="font-size: 0.9em;">
                  <span style="color: red;">El email es obligatorio.</span>
                </div>
                <div *ngIf="registroForm.get('email')?.touched && !registroForm.get('email')?.errors?.['required'] && registroForm.get('email')?.value && registroForm.get('email')?.value.indexOf('@') === -1" style="font-size: 0.9em;">
                  <span style="color: red;">El email debe contener '&#64;'.</span>
                </div>
                <div *ngIf="registroForm.get('email')?.touched && !registroForm.get('email')?.errors?.['required'] && registroForm.get('email')?.value && registroForm.get('email')?.value.indexOf('@') !== -1 && !registroForm.get('email')?.value.endsWith('.com')" style="font-size: 0.9em;">
                  <span style="color: red;">El email debe terminar en '.com'.</span>
                </div>
              </label>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label w-100">{{ 'REGISTRO.CONTRASENA' | translate }}
                <input formControlName="contrasena" type="password" class="form-control mt-1" placeholder="{{ 'REGISTRO.CONTRASENA' | translate }}" />
                <div *ngIf="registroForm.get('contrasena')?.touched && registroForm.get('contrasena')?.errors?.['minlength']" style="font-size: 0.9em;">
                  <span style="color: red;">La contraseña debe tener al menos 6 caracteres.</span>
                </div>
              </label>
            </div>
          </div>

          <div *ngIf="perfilSeleccionado === 'paciente'">
            <div class="mb-3">
              <label class="form-label">{{ 'REGISTRO.OBRA_SOCIAL' | translate }}</label>
              <input formControlName="obraSocial" class="form-control" placeholder="{{ 'REGISTRO.OBRA_SOCIAL' | translate }}" />
              <div *ngIf="registroForm.get('obraSocial')?.touched && registroForm.get('obraSocial')?.errors?.['required']" style="font-size: 0.9em;">
                <span style="color: red;">La obra social es obligatoria.</span>
              </div>
            </div>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label w-100">{{ 'REGISTRO.FOTO_PERFIL' | translate }}
                  <input type="file" class="form-control mt-1" (change)="seleccionarArchivoPaciente1($event)" />
                </label>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label w-100">{{ 'REGISTRO.SEGUNDA_IMAGEN' | translate }}
                  <input type="file" class="form-control mt-1" (change)="seleccionarArchivoPaciente2($event)" />
                </label>
              </div>
            </div>
          </div>

          <div *ngIf="perfilSeleccionado === 'especialista'">
            <div class="mb-3">
              <label class="form-label">{{ 'REGISTRO.ESPECIALIDAD' | translate }}</label>
              <input formControlName="especialidad" class="form-control" placeholder="{{ 'REGISTRO.ESCRIBA_ESPECIALIDAD' | translate }}"
                autocomplete="off" />
            </div>
            <ul class="list-group mt-1" *ngIf="especialidades.length && registroForm.get('especialidad')?.value">
              <li class="list-group-item list-group-item-action" *ngFor="
                let esp of especialidades
                  | filtro: registroForm.get('especialidad')?.value
              " (click)="agregarEspecialidad(esp)">
                {{ esp }}
              </li>
            </ul>
            <div class="chips mt-2 mb-2" *ngIf="especialidadesSeleccionadas.length">
              <span class="chip" *ngFor="let esp of especialidadesSeleccionadas">
                {{ esp }}
                <button type="button" (click)="eliminarEspecialidad(esp)">×</button>
              </span>
            </div>
            <div class="form-check mb-2">
              <input type="checkbox" id="nuevaEsp" class="form-check-input"
                formControlName="agregarEspecialidadManualmente" [(ngModel)]="agregarEspecialidadManualmente" />
              <label class="form-check-label" for="nuevaEsp">
                {{ 'REGISTRO.AGREGAR_ESPECIALIDAD_MANUAL' | translate }}
              </label>
            </div>
            <div *ngIf="agregarEspecialidadManualmente" class="mb-3">
              <label class="form-label">{{ 'REGISTRO.NUEVA_ESPECIALIDAD' | translate }}</label>
              <input formControlName="nuevaEspecialidad" class="form-control"
                placeholder="{{ 'REGISTRO.NUEVA_ESPECIALIDAD' | translate }}" />
            </div>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label w-100">{{ 'REGISTRO.FOTO_PERFIL' | translate }}
                  <input type="file" class="form-control mt-1" (change)="seleccionarArchivoEspecialista($event)" />
                </label>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label w-100">{{ 'REGISTRO.SEGUNDA_IMAGEN' | translate }}
                  <input type="file" class="form-control mt-1" (change)="seleccionarArchivoEspecialista($event)" />
                </label>
              </div>
            </div>
          </div>

          <!--  <div class="mt-3">
                <label class="form-label">{{ captchaPregunta }}</label>
                <input formControlName="captcha" class="form-control" appCaptcha  [resultadoEsperado]="captchaResultado" />
            </div>  -->

 <!--          
 <label>{{ captchaPregunta }}</label>
  <input
    type="text"
    formControlName="captcha"
    appCaptcha
    [resultadoEsperado]="captchaResultado"
  />
  <div *ngIf="registroForm.get('captcha')?.touched && registroForm.get('captcha')?.invalid">
    Respuesta incorrecta al captcha
  </div> -->


<div class="captcha-container">
  <label class="captcha-label">{{ 'REGISTRO.CAPTCHA_PREGUNTA' | translate }}: {{ captchaPregunta }}</label>
  <input
    type="text"
    formControlName="captcha"
    class="form-control captcha-input"
    appCaptcha
    [resultadoEsperado]="captchaResultado"
    placeholder="{{ 'REGISTRO.CAPTCHA_PLACEHOLDER' | translate }}"
  />
  <div class="captcha-error" *ngIf="registroForm.get('captcha')?.touched && registroForm.get('captcha')?.invalid">
    {{ 'REGISTRO.CAPTCHA_ERROR' | translate }}
  </div>
</div>



<!-- <p>Pregunta captcha: {{ captchaPregunta }}</p> -->


<!-- 
            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-primary w-50 me-2">Registrar</button>
                <button type="button" class="btn btn-secondary w-50 ms-2" (click)="cancelar()">Cancelar</button>
            </div> -->

  <div class="boton-acciones">
   <button 
     type="submit" 
     class="btn-primary"
   >
     {{ 'REGISTRO.BOTON_REGISTRAR' | translate }}
   </button>
   <button type="button" class="btn-secondary" (click)="cancelar()">{{ 'REGISTRO.BOTON_CANCELAR' | translate }}</button>
</div>

<div *ngIf="mensajeVisible" [ngClass]="{'alert-success': mensajeTipo === 'success', 'alert-danger': mensajeTipo === 'error'}" class="alert">
  {{ mensajeTexto }}
</div>


        </form>
    </div>
    
</div>

